- The Project:
	- The Task: to write an assembler for a specific assembly language defined here specifically for this project.




- CPU
	- Registers
	- Machine Instructions
- Assembly language 
	- Assembler 
		- Process: 
			1. Construct a file containing machine code from a given file of a program written in assembly language.
			2. Linkage. (Not part of the project)
			3. Loading. (Not part of the project)
- Machine code








## Machine Instructions

Base 4 Regular
Base 4 Encoded

- Machine Instruction Structure:
	- Each machine instruction is encoded into a sequence of consecutive **memory words**, 
		- range: min: one word, max: 5 words, depending on the addressing modes used (see later)
	- In the output file containing the machine code generated by the assembler, each word is encoded in the Base 4 Encoded as defined below (see explanations and examples later):

| Base 4 Regular | Base 4 Encoded |
| -------------- | -------------- |
| `0`            | `*`            |
| `1`            | `#`            |
| `2`            | `%`            |
| `3`            | `!`            |


### The first word

The structure of the first word is always the same. The structure of the first word in an instruction is as follows:


| d             | d                        |
| ------------- | ------------------------ |
| `1 0`         | A, R, E                  |
| `3 2`         | Operand Mode Source      |
| `5 4`         | Operand Mode Destination |
| `9 8 7 6`     | Opcode                   |
| `13 12 11 10` | Not used                 |


- Bits `0-1` (the '`A, R, E`' field):
	- In the first word of an instruction, these bits are always set to zero (`00`).
	- The 'A, R, E' field is added to each word in the instruction encoding (see the addressing modes details). 
	- This field indicates the type of encoding for the word: **Absolute**, **External**, or **Relocatable**.
		- The value `00` means that the word is encoded **absolutely** (requiring no changes in the linkage and loading stages). 
		- The value `01` means that the encoding is for an **external address** (requiring changes in the linkage and loading stages). 
		- The value `10` means that the encoding is for a **relocatable internal address** (requiring changes in the linkage and loading stages).
- Bits `2-3`: Encode the number of the addressing mode for the **destination operand**. If there is no destination operand in the instruction, the value of these bits is 0.
- Bits `4-5`: Encode the number of the addressing mode for the **source operand**. If there is no source operand in the instruction, the value of these bits is 0.
- Bits `6-9`: In the first word of the instruction, these bits represent the **operation code** (opcode). Each opcode is symbolically represented in assembly language by an **operation name**.

| Operation Code | Operation Name |
| -------------- | -------------- |
| 0              | mov            |
| 1              | cmp            |
| 2              | add            |
| 3              | sub            |
| 4              | not            |
| 5              | clr            |
| 6              | lea            |
| 7              | inc            |
| 8              | dec            |
| 9              | jmp            |
| 10             | bne            |
| 11             | red            |
| 12             | prn            |
| 13             | jsr            |
| 14             | rts            |
| 15             | hlt            |

- Bits `10-13`: not used and their value is `0`.

### Machine instructions specification

- **Program Counter** (PC)
	- This is an **internal register** of the processor (not a **general register**), which at any given moment contains the memory address where the current instruction being executed is located (always referring to the address of the first word of the instruction).

The machine instructions are divided into three groups, according to the number of operands required for the operation.

- The **first set** of instructions
	- number of operands: `2`
	- set: `mov, cmp, add, sub, lea`
- The **second set** of instructions:
	- number of operands: `1`
	- set: `not, clr, inc, dec, jmp, bne, red, prn, jsr`
	- The **encoding** of the operand: is the same as the target operand in a command with two operands. 
	- In this case, the field of the source operand (`4-5` bits ) In the first word in the coding of the instruction it is meaningless, and therefore will contain `00`.
- The **third set** of instructions:
	- number of operands: `0`
	- set: `rts, hlt`
	- The **encoding** of the operand: only one word
	- the field of the source & destination operands in the first word are not used, thus there are zero (???)

#### 1st set 

- The `mov` (Move) instruction is used to transfer data between registers, memory locations, and immediate values.
	- Syntax: `mov destination, source`
	- Example: `mov A, r1` copies the value from register `A` to register `r1`.
- The `cmp` (Compare) instruction performs a comparison between its two operands. the content of the destination operand (the second) is subtracted from the content of the source operand (the first), without saving the result of the subtraction. The subtraction operation updates a flag called the `Z` variable in the status register (PSW).
	- Syntax: `cmp operand1, operand2`
	- Example: `cmp A, r1`, If the contents of the variable `A` equal to the contents of register `r1` then the zero flag, `Z`, in the status register (PSW) will be turn on, otherwise the flag will be reset.
- The `add` (Addition) instruction performs integer addition between two operands and stores the result in the destination operand.
	- Syntax: `add destination, source`
	- Example: `add A, r0` adds the value in register `A` to the value in register `r0`.
- The `sub` (Subtraction) instruction performs integer subtraction between two operands and stores the result in the destination operand.
    - Syntax: `sub destination, source`
    - Example: `sub #3, r1`, register `r1` receives the result of subtracting the value `3` from the current contents of register `r1`.
- The `lea` (Load Effective Address) instruction places the address in memory represented by the label in the first operand (the source), to the destination operand (the second operand)
    - It does not access memory; it only computes the address.
    - Syntax: `lea .....???` 
    - Example: `lea HELLO, r1` The address represented by the label `HELLO` is placed in the `r1` register

#### 2st set 

- 


___


## Hardware

- "The computer in the project" 
	- consists of: 
		- CPU (Central Processing Unit)
			- Registers
				- 8 general registers named r0, r1, r2, r3, r4, r5, r6, r7. 
				- A Register: 14 bits. 
					- The least significant bit denoted as bit 0 and the most significant bit as bit 13. 
					- The register names are always written with a lowercase 'r'.
				- A register named **Program Status Word** (PSW), which contains flags characterizing the processor's state at any given moment.
		- Memory (stack). Some of the memory serves as a stack (RAM).
			- size: 4096 cells
			- addresses ranging from 0 to 4095 (decimal).
			- Each cell is 14 bits in size, referred to as a "word."
			- The bits in each word are numbered similarly to the register.


- the model of the virtual computer for this project:  #todo 

- #todo 
	- This computer operates only with positive and negative integers; there is no support for floating-point numbers. Arithmetic is performed using the two's complement method.
	- There is also support for characters, represented in ascii code




# Assembly Language

## Structure
### Macros

Reusable, symbolic names representing a sequence of instructions or other statements.

### Statements

 - Individual lines or units of code in a program.

  - 5 Types
	- Empty Statement
	- Comment Statement
	- Directive Statement
	- Instruction Statement
	- Definition of a Constant Statement





  - Marking the Dictionary in Machine Language Using the "A,R,E" Attribute
    - a=absolute
    - r=relocatable
    - e=external


## Algorithm Skeleton of the Assembler


## Input and Output Files of the Assembler


- Two-Pass Assembler
- Operation of the Assembler
- Object File Format
- Entries File Format
- Externals File Format


# Summary & General Instructions

- The length of the program, given as input to the assembler, is not known in advance, and therefore, the length of the translated program is not supposed to be predetermined. However, to facilitate the implementation of the assembler, a maximum size can be assumed. Therefore, it is possible to use arrays to store only the machine code image. Any other data structure (such as the symbol table and macro table) should be implemented efficiently and economically (for example, using a linked list and dynamic memory allocation).
- The names of the output files should match the input file name, except for the extensions. For example, if the input file is `prog.as`, then the output files created will be: `prog.ob`, `prog.ext`, `prog.ent`.
- The assembler's execution mode should be as required by the specification, without any changes. In particular, the user interface will be solely through the command line. Specifically, the names of the source files will be passed to the assembler as arguments on the command line. Interactive input menus, graphical windows, etc., should not be added.
- It is important to modularize the implementation of the assembler into several modules (C language files) according to tasks. Different tasks should not be concentrated in a single module. Recommended modules include: first pass, second pass, helper functions (such as translation to binary, syntax analysis of a line), symbol table, memory map, constant tables (operation codes, legal addressing modes for each operation, etc.).
- Care should be taken to document the implementation thoroughly and clearly, using detailed comments in the code.
- It should be possible to have extra spaces in the assembly language input file. For example, if an instruction line has two operands separated by a comma, spaces and tabs are allowed before and after the comma, as well as before and after the operation name. Empty lines are also allowed. The assembler will ignore unnecessary spaces (i.e., skip over them).
- The input (assembly code) may contain syntax errors. The assembler should detect and report all incorrect lines in the input. Processing of the input file should not stop after the first error is detected. Detailed messages should be printed to the screen whenever possible, so that it will be possible to understand what and where each error is. Of course, if the input file contains errors, there is no point in generating the output files (`ob`, `ext`, `ent`) for it.


___





2. **Macros and Statements:**
   - **Macros:**

   - **Statements:**


3. **5 Types of Statements:**
   - 1. **Empty Statement:**
        A statement with no operation or content.
   - 2. **Comment Statement:**
        A statement used for documentation and not executed by the assembler or compiler.
   - 3. **Directive Statement:**
        A statement that provides directives to the assembler, guiding the assembly process.
   - 4. **Instruction Statement:**
        A statement containing a machine-level instruction to be executed by the computer.
   - 5. **Definition of a Constant Statement:**
        A statement defining a constant value for use in the program.

4. **Specification of Fields in Assembly Statements:**
   - **Labels:**
     - Symbolic names assigned to memory locations or instructions for reference in the program.
   - **Definition of Labels:**
     - Explanation or assignment of symbolic labels to specific memory locations or instructions.
   - **Additional Information:**
     - Supplementary details including data, strings, data counters, instruction counters, and externals.

5. **Marking the Dictionary in Machine Language Using the "A,R,E" Attribute:**
   - - **a=absolute:**
       Denotes an absolute memory address.
   - - **r=relocatable:**
       Denotes a relocatable memory address.
   - - **e=external:**
       Denotes an external memory address.

6. **Algorithm Skeleton of the Assembler:**
   - The basic structure or framework of the algorithm used in the assembly process.

7. **Two-Pass Assembler:**
   - An assembler that processes the source code in two passes, allowing it to resolve symbols and addresses more efficiently.

8. **Input and Output Files of the Assembler:**
   - Files containing the source code to be assembled (input) and the resulting machine code (output).

9. **Operation of the Assembler:**
   - The functioning and processes involved in the assembly of source code into machine code.

10. **Object File Format:**
    - The structure and layout of the file containing the assembled machine code.

11. **Entries File Format:**
    - The format used for entries in the assembled code, often related to symbol tables.

12. **Externals File Format:**
    - The format used for external references in the assembled code.

13. **Summary and General Instructions:**
    - A concise overview and general guidance for using or understanding the assembled program.

Feel free to adapt these definitions based on your specific context and requirements.





___

- an assembly program is divided into three sections 
	- the **text section** contains the actual logic for the program by convention it contains an entry point called start which is where the code will start executing 
	- the **block starting symbol section** which contains variables that might change throughout the lifecycle of the app 
	- the **data section** is where we can initialize constants or data that does not change 

